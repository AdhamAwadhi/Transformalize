<?xml version="1.0" encoding="utf-8"?>

<process>

  <providers>
    <add name="sqlserver" type="System.Data.SqlClient.SqlConnection, System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
    <add name="mysql" type="MySql.Data.MySqlClient.MySqlConnection, MySql.Data"></add>
  </providers>

  <connections>
    <add name="input" value="Server=localhost;Database=NorthWind;Trusted_Connection=True;" />
    <add name="output" value="Server=localhost;Database=NorthWindStar;Trusted_Connection=True;" />
    <add name="ssas" value="Data Source=localhost;Catalog=NorthWind;" provider="AnalysisServices"></add>
  </connections>

  <templates path="Templates">
    <add name="solr-data-handler" file="solr-data-handler.cshtml" cache="true">
      <actions>
        <add action="copy" file="C:\Solr\NorthWind\conf\data-config.xml" />
      </actions>
    </add>
    <add name="solr-schema" file="solr-schema.cshtml" cache="true">
      <actions>
        <add action="copy" file="C:\Solr\NorthWind\conf\schema.xml" />
      </actions>
    </add>
  </templates>

  <search-types>
    <add name="default" />
    <add name="facet" type="lowercase" store="true" index="true" />
    <add name="standard" type="standard_lowercase" store="false" index="true"/>
  </search-types>

  <entities>
    
    <add name="Order Details" version="RowVersion" auto="true" prefix="OrderDetails">
      <calculated-fields>
        <add name="OrderDetailsExtendedPrice" type="Decimal" precision="19" scale="4">
          <transforms>
            <add method="javascript" script="OrderDetailsQuantity * (OrderDetailsUnitPrice * (1-OrderDetailsDiscount))" parameter="*" />
          </transforms>
        </add>
      </calculated-fields>
    </add>

    <add name="Orders" version="RowVersion" auto="true" prefix="Orders">
      <fields>
        <add name="RowVersion" alias="OrdersRowVersion" type="byte[]"></add>
      </fields>

      <calculated-fields>
        <add name="TimeOrderMonth" length="6" default="12-DEC">
          <transforms>
            <add method="dateformat" format="MM-MMM" parameter="OrderDate" />
            <add method="toUpper" />
          </transforms>
        </add>
        <add name="TimeOrderDate" length="10" default="9999-12-31">
          <transforms>
            <add method="dateformat" format="yyyy-MM-dd" parameter="OrderDate" />
          </transforms>
        </add>
        <add name="TimeOrderYear" length="4" default="9999">
          <transforms>
            <add method="dateformat" format="yyyy" parameter="OrderDate" />
          </transforms>
        </add>
      </calculated-fields>
    </add>
    
    <add name="Customers" version="RowVersion" auto="true" prefix="Customers"/>
    
    <add name="Employees" version="RowVersion" auto="true" prefix="Employees">
      <fields>
        <add name="RowVersion" alias="EmployeesRowVersion" type="byte[]"></add>
        <add name="ReportsTo" alias="EmployeesManager" type="string" length="64">
          <transforms>
            <add method="map" map="Managers"></add>
          </transforms>
        </add>
        <add name="Photo" alias="EmployeesPhoto" input="false" output="false"></add>
        <add name="PhotoPath" alias="EmployeesPhotoPath" input="false" output="false"></add>
      </fields>
      <transforms>
        <add method="join" separator=" " result="Employee">
          <parameters>
            <add field="FirstName"></add>
            <add field="LastName"></add>
          </parameters>
        </add>
      </transforms>
    </add>
    
    <add name="Products" version="RowVersion" auto="true" prefix="Products"/>
    
    <add name="Suppliers" version="RowVersion" auto="true" prefix="Suppliers"/>
    
    <add name="Categories" version="RowVersion" auto="true" prefix="Categories">
      <fields>
        <add name="RowVersion" alias="CategoriesRowVersion" type="byte[]" input="false"></add>
        <add name="Picture" alias="CategoriesPicture" type="byte[]" input="false"></add>
      </fields>
    </add>
    
    <add name="Shippers" version="RowVersion" auto="true" prefix="Shippers"/>
    
  </entities>

  <relationships>
    <add leftEntity="Order Details" leftField="OrderID" rightEntity="Orders" rightField="OrderID" />
    <add leftEntity="Orders" leftField="CustomerID" rightEntity="Customers" rightField="CustomerID" />
    <add leftEntity="Orders" leftField="EmployeeID" rightEntity="Employees" rightField="EmployeeID" />
    <add leftEntity="Orders" leftField="ShipVia" rightEntity="Shippers" rightField="ShipperID" />
    <add leftEntity="Order Details" leftField="ProductID" rightEntity="Products" rightField="ProductID" />
    <add leftEntity="Products" leftField="SupplierID" rightEntity="Suppliers" rightField="SupplierID" />
    <add leftEntity="Products" leftField="CategoryID" rightEntity="Categories" rightField="CategoryID" />
  </relationships>

  <calculated-fields>
    <add name="CountryExchange" length="128">
      <transforms>
        <add method="format" format="{0} to {1}">
          <parameters>
            <add field="SuppliersCountry"></add>
            <add field="OrdersShipCountry"></add>
          </parameters>
        </add>
      </transforms>
    </add>
  </calculated-fields>
  
  <maps>
    <add name="Managers" connection="input">
      <items sql="select EmployeeID, FirstName + ' ' + LastName FROM Employees;" />
    </add>
  </maps>

</process>