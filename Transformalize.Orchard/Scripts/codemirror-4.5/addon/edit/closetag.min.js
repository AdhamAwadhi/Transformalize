(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../fold/xml-fold")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],n):n(CodeMirror)})(function(n){function f(f){var h,p,b,y,e,l,k;if(f.getOption("disableInput"))return n.Pass;for(h=f.listSelections(),p=[],e=0;e<h.length;e++){if(!h[e].empty())return n.Pass;var s=h[e].head,o=f.getTokenAt(s),w=n.innerMode(f.getMode(),o.state),a=w.state;if(w.mode.name!="xml"||!a.tagName)return n.Pass;var v=f.getOption("autoCloseTags"),d=w.mode.configuration=="html",g=typeof v=="object"&&v.dontCloseTags||d&&r,nt=typeof v=="object"&&v.indentTags||d&&u,c=a.tagName;if(o.end>s.ch&&(c=c.slice(0,c.length-o.end+s.ch)),b=c.toLowerCase(),!c||o.type=="string"&&(o.end!=s.ch||!/[\"\']/.test(o.string.charAt(o.string.length-1))||o.string.length==1)||o.type=="tag"&&a.type=="closeTag"||o.string.indexOf("/")==o.string.length-1||g&&t(g,b)>-1||i(f,c,s,a,!0))return n.Pass;y=nt&&t(nt,b)>-1;p[e]={indent:y,text:">"+(y?"\n\n":"")+"<\/"+c+">",newPos:y?n.Pos(s.line+1,0):n.Pos(s.line,s.ch+1)}}for(e=h.length-1;e>=0;e--)l=p[e],f.replaceRange(l.text,h[e].head,h[e].anchor,"+insert"),k=f.listSelections().slice(0),k[e]={head:l.newPos,anchor:l.newPos},f.setSelections(k),l.indent&&(f.indentLine(l.newPos.line,null,!0),f.indentLine(l.newPos.line+1,null,!0))}function e(t){var u,o,r;if(t.getOption("disableInput"))return n.Pass;for(u=t.listSelections(),o=[],r=0;r<u.length;r++){if(!u[r].empty())return n.Pass;var s=u[r].head,e=t.getTokenAt(s),h=n.innerMode(t.getMode(),e.state),f=h.state;if(e.type=="string"||e.string.charAt(0)!="<"||e.start!=s.ch-1||h.mode.name!="xml"||!f.context||!f.context.tagName||i(t,f.context.tagName,s,f))return n.Pass;o[r]="/"+f.context.tagName+">"}for(t.replaceSelections(o),u=t.listSelections(),r=0;r<u.length;r++)(r==u.length-1||u[r].head.line<u[r+1].head.line)&&t.indentLine(u[r].head.line)}function t(n,t){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;++i)if(n[i]==t)return i;return-1}function i(t,i,r,u,f){var h,o,e,c,l,s;if(!n.scanForClosingTag||(h=Math.min(t.lastLine()+1,r.line+500),o=n.scanForClosingTag(t,r,null,h),!o||o.tag!=i))return!1;for(e=u.context,c=f?1:0;e&&e.tagName==i;e=e.prev)++c;for(r=o.to,l=1;l<c;l++){if(s=n.scanForClosingTag(t,r,null,h),!s||s.tag!=i)return!1;r=s.to}return!0}n.defineOption("autoCloseTags",!1,function(t,i,r){if(r!=n.Init&&r&&t.removeKeyMap("autoCloseTags"),i){var u={name:"autoCloseTags"};(typeof i!="object"||i.whenClosing)&&(u["'/'"]=function(n){return e(n)});(typeof i!="object"||i.whenOpening)&&(u["'>'"]=function(n){return f(n)});t.addKeyMap(u)}});var r=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],u=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]});
//# sourceMappingURL=closetag.min.js.map
