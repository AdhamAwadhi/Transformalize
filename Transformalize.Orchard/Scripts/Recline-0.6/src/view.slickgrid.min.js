this.recline=this.recline||{};this.recline.View=this.recline.View||{},function(n,t){"use strict";t.SlickGrid=Backbone.View.extend({initialize:function(n){var r=this,i;this.$el.addClass("recline-slickgrid");this.templates={deleterow:'<a href="#" class="recline-row-delete btn" title="Delete row">X<\/a>'};_.bindAll(this,"render","onRecordChanged");this.listenTo(this.model.records,"add remove reset",this.render);this.listenTo(this.model.records,"change",this.onRecordChanged);i=_.extend({hiddenColumns:[],columnsOrder:[],columnsSort:{},columnsWidth:[],columnsEditor:[],options:{},fitColumns:!1},n.state);this.state=new recline.Model.ObjectState(i);this._slickHandler=new Slick.EventHandler;this.state.get("gridOptions")&&this.state.get("gridOptions").enabledAddRow!=undefined&&this.state.get("gridOptions").enabledAddRow==!0&&(this.editor=new t.GridControl,this.elSidebar=this.editor.$el,this.listenTo(this.editor.state,"change",function(){this.model.records.add(new recline.Model.Record)}))},onRecordChanged:function(n){if(this.grid){var t=this.grid.getData().getModelRow(n);this.grid.invalidateRow(t);this.grid.getData().updateItem(n,t);this.grid.render()}},render:function(){function c(t){var i={};return n.model.fields.each(function(n){var r="";_.isUndefined(t.getFieldValueUnrendered(n))||(r=t.getFieldValueUnrendered(n));i[n.id]=r}),i}function v(){var n=[],t=[];this.push=function(i,r){n.push(i);t.push(r)};this.getLength=function(){return t.length};this.getItem=function(n){return t[n]};this.getItemMetadata=function(){return{}};this.getModel=function(t){return n[t]};this.getModelRow=function(t){return _.indexOf(n,t)};this.updateItem=function(i,r){t[r]=c(i);n[r]=i}}var n=this,o=_.extend({enableCellNavigation:!0,enableColumnReorder:!0,explicitInitialization:!0,syncColumnCellResize:!0,forceFitColumns:this.state.get("fitColumns")},n.state.get("gridOptions")),t=[],s=function(t,i,r,u,f){if(u.id=="del")return n.templates.deleterow;var e=n.model.fields.get(u.id);return e.renderer?e.renderer(r,e,f):r},h=function(n){return function(t){return n.type=="date"&&isNaN(Date.parse(t))?{valid:!1,msg:"A date is required, check field field-date-format"}:{valid:!0,msg:null}}},i,e,r,u,f,l,a,y;for(this.state.get("gridOptions")&&this.state.get("gridOptions").enableReOrderRow==!0&&t.push({id:"#",name:"",width:22,behavior:"selectAndMove",selectable:!1,resizable:!1,cssClass:"recline-cell-reorder"}),this.state.get("gridOptions")&&this.state.get("gridOptions").enabledDelRow==!0&&t.push({id:"del",name:"",field:"del",sortable:!0,width:38,formatter:s,validator:h}),_.each(this.model.fields.toJSON(),function(i){var r={id:i.id,name:i.label,field:i.id,sortable:!0,minWidth:80,formatter:s,validator:h(i)},e=_.find(n.state.get("columnsWidth"),function(n){return n.column===i.id}),u,f;e&&(r.width=e.width);u=_.find(n.state.get("columnsEditor"),function(n){return n.column===i.id});u?r.editor=u.editor:(f={string:Slick.Editors.LongText,integer:Slick.Editors.IntegerEditor,number:Slick.Editors.Text,date:Slick.Editors.Text,boolean:Slick.Editors.YesNoSelectEditor},r.editor=i.type in f?f[i.type]:Slick.Editors.LongText);t.push(r)}),i=_.filter(t,function(t){return _.indexOf(n.state.get("hiddenColumns"),t.id)===-1}),this.state.get("columnsOrder")&&this.state.get("columnsOrder").length>0&&(i=i.sort(function(t,i){return _.indexOf(n.state.get("columnsOrder"),t.id)>_.indexOf(n.state.get("columnsOrder"),i.id)?1:-1}),t=t.sort(function(t,i){return _.indexOf(n.state.get("columnsOrder"),t.id)>_.indexOf(n.state.get("columnsOrder"),i.id)?1:-1})),e=[],r=t.length-1;r>=0;r--)_.indexOf(_.pluck(i,"id"),t[r].id)===-1&&e.push(t.splice(r,1)[0]);return t=t.concat(e),u=new v,this.model.records.each(function(n){u.push(n,c(n))}),this.grid=new Slick.Grid(this.el,u,i,o),f=this.model.queryState.get("sort"),f&&(l=f[0].field,a=f[0].order!=="desc",this.grid.setSortColumn(l,a)),this.state.get("gridOptions")&&this.state.get("gridOptions").enableReOrderRow&&this._setupRowReordering(),this._slickHandler.subscribe(this.grid.onSort,function(t,i){var r=i.sortAsc?"asc":"desc",u=[{field:i.sortCol.field,order:r}];n.model.query({sort:u})}),this._slickHandler.subscribe(this.grid.onColumnsReordered,function(){n.state.set({columnsOrder:_.pluck(n.grid.getColumns(),"id")})}),this.grid.onColumnsResized.subscribe(function(t,i){var u=i.grid.getColumns(),f=i.grid.getOptions().defaultColumnWidth,r=[];_.each(u,function(n){n.width!=f&&r.push({column:n.id,width:n.width})});n.state.set({columnsWidth:r})}),this._slickHandler.subscribe(this.grid.onCellChange,function(n,t){var f=t.grid,e=u.getModel(t.row),i=f.getColumns()[t.cell].id,r={};r[i]=t.item[i];e.set(r)}),this._slickHandler.subscribe(this.grid.onClick,function(t,i){var r,f;try{t.preventDefault()}catch(t){}r=0;n.state.get("gridOptions")&&n.state.get("gridOptions").enableReOrderRow!=undefined&&n.state.get("gridOptions").enableReOrderRow==!0&&(r=1);i.cell==r&&n.state.get("gridOptions").enabledDelRow==!0&&(f=u.getModel(i.row),f.destroy())}),y=new Slick.Controls.ColumnPicker(t,this.grid,_.extend(o,{state:this.state})),n.visible?(n.grid.init(),n.rendered=!0):n.rendered=!1,this},_setupRowReordering:function(){var n=this,t;n.grid.setSelectionModel(new Slick.RowSelectionModel);t=new Slick.RowMoveManager({cancelEditOnDrag:!0});t.onBeforeMoveRows.subscribe(function(n,t){for(var i=0;i<t.rows.length;i++)if(t.rows[i]==t.insertBefore||t.rows[i]==t.insertBefore-1)return n.stopPropagation(),!1;return!0});t.onMoveRows.subscribe(function(t,i){var c=[],e,h,u=i.rows,o=i.insertBefore,f=n.model.records.toJSON(),s,l,r;for(e=f.slice(0,o),h=f.slice(o,f.length),u.sort(function(n,t){return n-t}),r=0;r<u.length;r++)c.push(f[u[r]]);for(u.reverse(),r=0;r<u.length;r++)s=u[r],s<o?e.splice(s,1):h.splice(s-o,1);for(f=e.concat(c.concat(h)),l=[],r=0;r<u.length;r++)l.push(e.length+r);n.model.records.reset(f)});this.state.get("gridOptions")&&this.state.get("gridOptions").enableReOrderRow&&n.grid.registerPlugin(t)},remove:function(){this._slickHandler.unsubscribeAll();Backbone.View.prototype.remove.apply(this,arguments)},show:function(){this.rendered||(this.grid||this.render(),this.grid.init(),this.rendered=!0);this.visible=!0},hide:function(){this.visible=!1}});t.GridControl=Backbone.View.extend({className:"recline-row-add",template:'<h1><a href="#" class="recline-row-add btn">Add row<\/a><\/h1>',initialize:function(){var n=this;_.bindAll(this,"render");this.state=new recline.Model.ObjectState;this.render()},render:function(){var n=this;this.$el.html(this.template)},events:{"click .recline-row-add":"addNewRow"},addNewRow:function(n){n.preventDefault();this.state.trigger("change")}})}(jQuery,recline.View),function(n){function t(t,i,r){function o(){i.onHeaderContextMenu.subscribe(s);r=n.extend({},e,r);u=n('<ul class="dropdown-menu slick-contextmenu" style="display:none;position:absolute;z-index:20;" />').appendTo(document.body);u.bind("mouseleave",function(){n(this).fadeOut(r.fadeSpeed)});u.bind("click",h)}function s(e){var h,s,o;for(e.preventDefault(),u.empty(),f=[],o=0;o<t.length;o++)h=n("<li />").appendTo(u),s=n('<input type="checkbox" />').data("column-id",t[o].id).attr("id","slick-column-vis-"+t[o].id),f.push(s),i.getColumnIndex(t[o].id)!==null&&s.attr("checked","checked"),s.appendTo(h),n("<label />").text(t[o].name).attr("for","slick-column-vis-"+t[o].id).appendTo(h);n("<li/>").addClass("divider").appendTo(u);h=n("<li />").data("option","autoresize").appendTo(u);s=n('<input type="checkbox" />').data("option","autoresize").attr("id","slick-option-autoresize");s.appendTo(h);n("<label />").text("Force fit columns").attr("for","slick-option-autoresize").appendTo(h);i.getOptions().forceFitColumns&&s.attr("checked","checked");u.css("top",e.pageY-10).css("left",e.pageX-10).fadeIn(r.fadeSpeed)}function h(u){var e,o,s,h;if(n(u.target).data("option")==="autoresize"){n(u.target).is("li")?(e=n(u.target).find("input").first(),o=!e.is(":checked"),e.attr("checked",o)):o=u.target.checked;o?(i.setOptions({forceFitColumns:!0}),i.autosizeColumns()):i.setOptions({forceFitColumns:!1});r.state.set({fitColumns:o});return}if(n(u.target).is("li")&&!n(u.target).hasClass("divider")||n(u.target).is("input")){if(n(u.target).is("li")&&(e=n(u.target).find("input").first(),e.attr("checked",!e.is(":checked"))),s=[],h=[],n.each(f,function(i){n(this).is(":checked")?s.push(t[i]):h.push(t[i].id)}),!s.length){n(u.target).attr("checked","checked");return}i.setColumns(s);r.state.set({hiddenColumns:h})}}var u,f,e={fadeSpeed:250};o()}n.extend(!0,window,{Slick:{Controls:{ColumnPicker:t}}})}(jQuery);
//# sourceMappingURL=view.slickgrid.min.js.map
