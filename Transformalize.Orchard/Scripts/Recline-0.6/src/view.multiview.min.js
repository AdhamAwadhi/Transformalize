this.recline=this.recline||{};this.recline.View=this.recline.View||{},function(n,t){"use strict";t.MultiView=Backbone.View.extend({template:'   <div class="recline-data-explorer">     <div class="alert-messages"><\/div>         <div class="header clearfix">       <div class="navigation">         <div class="btn-group" data-toggle="buttons-radio">         {{#views}}         <a href="#{{id}}" data-view="{{id}}" class="btn">{{label}}<\/a>         {{/views}}         <\/div>       <\/div>       <div class="recline-results-info">         <span class="doc-count">{{recordCount}}<\/span> records      <\/div>       <div class="menu-right">         <div class="btn-group" data-toggle="buttons-checkbox">           {{#sidebarViews}}           <a href="#" data-action="{{id}}" class="btn">{{label}}<\/a>           {{/sidebarViews}}         <\/div>       <\/div>       <div class="query-editor-here" style="display:inline;"><\/div>     <\/div>     <div class="data-view-sidebar"><\/div>     <div class="data-view-container"><\/div>   <\/div>   ',events:{"click .menu-right a":"_onMenuClick","click .navigation a":"_onSwitchView"},initialize:function(n){var i=this;this._setupState(n.state);this.pageViews=n.views?n.views:[{id:"grid",label:"Grid",view:new t.SlickGrid({model:this.model,state:this.state.get("view-grid")})},{id:"graph",label:"Graph",view:new t.Graph({model:this.model,state:this.state.get("view-graph")})},{id:"map",label:"Map",view:new t.Map({model:this.model,state:this.state.get("view-map")})},{id:"timeline",label:"Timeline",view:new t.Timeline({model:this.model,state:this.state.get("view-timeline")})}];this.sidebarViews=n.sidebarViews?n.sidebarViews:[{id:"filterEditor",label:"Filters",view:new t.FilterEditor({model:this.model})},{id:"fieldsView",label:"Fields",view:new t.Fields({model:this.model})}];this.render();this._bindStateChanges();this._bindFlashNotifications();this.state.get("readOnly")&&this.setReadOnly();this.state.get("currentView")?this.updateNav(this.state.get("currentView")):this.updateNav(this.pageViews[0].id);this._showHideSidebar();this.listenTo(this.model,"query:start",function(){i.notify({loader:!0,persist:!0})});this.listenTo(this.model,"query:done",function(){i.clearNotifications();i.$el.find(".doc-count").text(i.model.recordCount||"Unknown")});this.listenTo(this.model,"query:fail",function(n){i.clearNotifications();var t="";typeof n=="string"?t=n:typeof n=="object"?(n.title&&(t=n.title+": "),n.message&&(t+=n.message)):t="There was an error querying the backend";i.notify({message:t,category:"error",persist:!0})});this.model.queryState.set(i.state.get("query"),{silent:!0})},setReadOnly:function(){this.$el.addClass("recline-read-only")},render:function(){var n=this.model.toTemplateJSON(),i,r,t;n.views=this.pageViews;n.sidebarViews=this.sidebarViews;i=Mustache.render(this.template,n);this.$el.html(i);r=this.$el.find(".data-view-container");t=this.$el.find(".data-view-sidebar");_.each(this.pageViews,function(n){n.view.render();n.view.redraw&&n.view.redraw();r.append(n.view.el);n.view.elSidebar&&t.append(n.view.elSidebar)});_.each(this.sidebarViews,function(n){this["$"+n.id]=n.view.$el;t.append(n.view.el)},this);this.pager=new recline.View.Pager({model:this.model});this.$el.find(".recline-results-info").after(this.pager.el);this.queryEditor=new recline.View.QueryEditor({model:this.model.queryState});this.$el.find(".query-editor-here").append(this.queryEditor.el)},remove:function(){_.each(this.pageViews,function(n){n.view.remove()});_.each(this.sidebarViews,function(n){n.view.remove()});this.pager.remove();this.queryEditor.remove();Backbone.View.prototype.remove.apply(this,arguments)},_showHideSidebar:function(){var t=this.$el.find(".data-view-sidebar"),i=t.children().filter(function(){return n(this).css("display")!="none"}).length;i>0?t.show():t.hide()},updateNav:function(n){this.$el.find(".navigation a").removeClass("active");var t=this.$el.find('.navigation a[data-view="'+n+'"]');t.addClass("active");_.each(this.pageViews,function(t){t.id===n?(t.view.$el.show(),t.view.elSidebar&&t.view.elSidebar.show()):(t.view.$el.hide(),t.view.elSidebar&&t.view.elSidebar.hide(),t.view.hide&&t.view.hide())});this._showHideSidebar();_.each(this.pageViews,function(t){t.id===n&&t.view.show&&t.view.show()})},_onMenuClick:function(t){t.preventDefault();var i=n(t.target).attr("data-action");this["$"+i].toggle();this._showHideSidebar()},_onSwitchView:function(t){t.preventDefault();var i=n(t.target).attr("data-view");this.updateNav(i);this.state.set({currentView:i})},_setupState:function(n){var e=this,u=t.parseHashQueryString(),r=u.reclineQuery,i,f;r=r?JSON.parse(r):e.model.queryState.toJSON();i=u["view-graph"]||u.graph;i=i?JSON.parse(i):{};f=_.extend({query:r,"view-graph":i,backend:this.model.backend.__type__,url:this.model.get("url"),dataset:this.model.toJSON(),currentView:null,readOnly:!1},n);this.state=new recline.Model.ObjectState(f)},_bindStateChanges:function(){var n=this;this.listenTo(this.model.queryState,"change",function(){n.state.set({query:n.model.queryState.toJSON()})});_.each(this.pageViews,function(t){if(t.view.state&&t.view.state.bind){var i={};i["view-"+t.id]=t.view.state.toJSON();n.state.set(i);n.listenTo(t.view.state,"change",function(){var i={};i["view-"+t.id]=t.view.state.toJSON();n.state.set(i,{silent:!0});n.state.trigger("change")})}})},_bindFlashNotifications:function(){var n=this;_.each(this.pageViews,function(t){n.listenTo(t.view,"recline:flash",function(t){n.notify(t)})})},notify:function(t){var r=_.extend({message:"Loading",category:"warning",loader:!1},t),u,i;u=r.loader?'         <div class="alert alert-info alert-loader">           {{message}}           <span class="notification-loader">&nbsp;<\/span>         <\/div>':'         <div class="alert alert-{{category}} fade in" data-alert="alert"><a class="close" data-dismiss="alert" href="#">×<\/a>           {{message}}         <\/div>';i=n(Mustache.render(u,r));i=n(i).appendTo(n(".recline-data-explorer .alert-messages"));t.persist||setTimeout(function(){n(i).fadeOut(1e3,function(){n(this).remove()})},1e3)},clearNotifications:function(){var t=n(".recline-data-explorer .alert-messages .alert");t.fadeOut(1500,function(){n(this).remove()})}});t.MultiView.restore=function(n){var i,r,u;return i=n.backend==="memory"?{backend:"memory",records:[{stub:"this is a stub dataset because we do not restore memory datasets"}]}:_.extend({url:n.url,backend:n.backend},n.dataset),r=new recline.Model.Dataset(i),u=new t.MultiView({model:r,state:n}),u};var i=/^([^?]+)(\?.*)?/;t.parseHashUrl=function(n){var t=i.exec(n);return t===null?{}:{path:t[1],query:t[2]||""}};t.parseQueryString=function(n){if(!n)return{};var i={},t,r=function(n){return unescape(n.replace(/\+/g," "))},u=/([^&=]+)=?([^&]*)/g;for(n&&n.length&&n[0]==="?"&&(n=n.slice(1));t=u.exec(n);)i[r(t[1])]=r(t[2]);return i};t.parseHashQueryString=function(){var n=t.parseHashUrl(window.location.hash).query;return t.parseQueryString(n)};t.composeQueryString=function(t){var i=[];return n.each(t,function(n,t){typeof t=="object"&&(t=JSON.stringify(t));i.push(n+"="+encodeURIComponent(t))}),"?"+i.join("&")};t.getNewHashForQueryString=function(n){var i=t.composeQueryString(n);return window.location.hash?window.location.hash.split("?")[0].slice(1)+i:i};t.setHashQueryString=function(n){window.location.hash=t.getNewHashForQueryString(n)}}(jQuery,recline.View);
//# sourceMappingURL=view.multiview.min.js.map
