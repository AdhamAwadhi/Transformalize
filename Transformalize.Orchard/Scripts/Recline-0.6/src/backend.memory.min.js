this.recline=this.recline||{};this.recline.Backend=this.recline.Backend||{};this.recline.Backend.Memory=this.recline.Backend.Memory||{},function(n){"use strict";n.__type__="memory";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;n.Store=function(n,i){var r=this;this.records=n;this.data=this.records;i?this.fields=i:n&&(this.fields=_.map(n[0],function(n,t){return{id:t,type:"string"}}));this.update=function(n){_.each(r.records,function(t,i){n.id===t.id&&(r.records[i]=n)})};this.remove=function(n){var t=_.reject(r.records,function(t){return n.id===t.id});this.records=t};this.save=function(n){var i=this,r=new t;return _.each(n.updates,function(n){i.update(n)}),_.each(n.deletes,function(n){i.remove(n)}),r.resolve(),r.promise()};this.query=function(n){var r=new t,o=n.size||this.records.length,u=n.from||0,i=this.records,f,e;return i=this._applyFilters(i,n),i=this._applyFreeTextQuery(i,n),_.each(n.sort,function(n){var t=n.field;i=_.sortBy(i,function(n){return n[t]});n.order=="desc"&&i.reverse()}),f=this.computeFacets(i,n),e={total:i.length,hits:i.slice(u,u+o),facets:f},r.resolve(e),r.promise()};this._applyFilters=function(n,t){function i(n){var t=u[n.field].type||"string";return o[t]}function s(n,t){var r=i(t),u=r(n[t.field]),f=r(t.term);return u===f}function h(n,t){var r=i(t),u=r(n[t.field]),f=r(t.terms).split(",");return _.indexOf(f,u)>=0}function c(n,t){var r=_.isUndefined(t.from)||t.from===null||t.from==="",u=_.isUndefined(t.to)||t.to===null||t.to==="",f=i(t),e=f(n[t.field]),o=f(r?"":t.from),s=f(u?"":t.to);return(!r||!u)&&e===""?!1:(r||e>=o)&&(u||e<=s)}function l(){}var f=t.filters,e={term:s,terms:h,range:c,geo_distance:l},o={integer:function(n){return parseFloat(n,10)},float:function(n){return parseFloat(n,10)},number:function(n){return parseFloat(n,10)},string:function(n){return n.toString()},date:function(n){return moment(n).valueOf()},datetime:function(n){return new Date(n).valueOf()}},u={};return _.each(r.fields,function(n){u[n.id]=n}),_.filter(n,function(n){var t=_.map(f,function(t){return e[t.type](n,t)});return _.all(t,_.identity)})};this._applyFreeTextQuery=function(n,t){if(t.q){var i=t.q.split(" "),u=_.map(i,function(n){return new RegExp(n.toLowerCase())});n=_.filter(n,function(n){var t=!0;return _.each(u,function(i){var u=!1;_.each(r.fields,function(t){var r=n[t.id];r=r!==null&&r!==undefined?r.toString():"";u=u||i.test(r.toLowerCase())});t=t&&u}),t})}return n};this.computeFacets=function(n,t){var i={};return t.facets?(_.each(t.facets,function(n,t){i[t]=new recline.Model.Facet({id:t}).toJSON();i[t].termsall={}}),_.each(n,function(n){_.each(t.facets,function(t,r){var e=t.terms.field,f=n[e],u=i[r];f?u.termsall[f]=u.termsall[f]?u.termsall[f]+1:1:u.missing=u.missing+1})}),_.each(t.facets,function(n,t){var r=i[t],u=_.map(r.termsall,function(n,t){return{term:t,count:n}});r.terms=_.sortBy(u,function(n){return-n.count});r.terms=r.terms.slice(0,10)}),i):i}}}(this.recline.Backend.Memory);
//# sourceMappingURL=backend.memory.min.js.map
