this.recline=this.recline||{};this.recline.View=this.recline.View||{},function(n,t){"use strict";typeof VMM!="undefined"&&(VMM.debug=!1);t.Timeline=Backbone.View.extend({template:'     <div class="recline-timeline">       <div id="vmm-timeline-id"><\/div>     <\/div>   ',startFieldNames:["date","startdate","start","start-date"],endFieldNames:["end","endDate"],elementId:"#vmm-timeline-id",initialize:function(n){var t=this,i;this.timeline=new VMM.Timeline(this.elementId);this._timelineIsInitialized=!1;this.listenTo(this.model.fields,"reset",function(){t._setupTemporalField()});this.listenTo(this.model.records,"all",function(){t.reloadData()});i=_.extend({startField:null,endField:null,nonUSDates:!1,timelineJSOptions:{}},n.state);this.state=new recline.Model.ObjectState(i);this._setupTemporalField()},render:function(){var t=Mustache.render(this.template,{});this.$el.html(t);n(this.elementId).length>0&&this._initTimeline()},show:function(){this._timelineIsInitialized===!1&&this._initTimeline()},_initTimeline:function(){var t=this._timelineJSON(),n=this.state.get("timelineJSOptions");n.id=this.elementId;this.timeline.init(n,t);this._timelineIsInitialized=!0},reloadData:function(){if(this._timelineIsInitialized){var n=this._timelineJSON();this.timeline.reload(n)}},convertRecord:function(n,t){return this._convertRecord(n,t)},_convertRecord:function(n){var t=this._parseDate(n.get(this.state.get("startField"))),i=this._parseDate(n.get(this.state.get("endField")));return t?{startDate:t,endDate:i,headline:String(n.get("title")||""),text:n.get("description")||n.summary(),tag:n.get("tags")}:null},_timelineJSON:function(){var t=this,n={timeline:{type:"default",headline:"",date:[]}},i;return this.model.records.each(function(i){var r=t.convertRecord(i,t.fields);r&&n.timeline.date.push(r)}),n.timeline.date.length===0&&(i={startDate:"2000,1,1",headline:"No data to show!"},n.timeline.date.push(i)),n},_parseDate:function(t){var i,r;return t?(i=n.trim(t),i=i.replace(/(\d)th/g,"$1"),i=i.replace(/(\d)st/g,"$1"),i=n.trim(i),i.match(/\d\d\d\d-\d\d-\d\d(T.*)?/)&&(i=i.replace(/-/g,",").replace("T",",").replace(":",",")),i.match(/\d\d-\d\d-\d\d.*/)&&(i=i.replace(/-/g,"/")),this.state.get("nonUSDates")&&(r=i.match(/(\d\d)\/(\d\d)\/(\d\d.*)/),r&&(i=[r[2],r[1],r[3]].join("/"))),i):null},_setupTemporalField:function(){this.state.set({startField:this._checkField(this.startFieldNames),endField:this._checkField(this.endFieldNames)})},_checkField:function(n){for(var t,i=this.model.fields.pluck("id"),r=0;r<n.length;r++)for(t=0;t<i.length;t++)if(i[t].toLowerCase()==n[r].toLowerCase())return i[t];return null}})}(jQuery,recline.View);
//# sourceMappingURL=view.timeline.min.js.map
